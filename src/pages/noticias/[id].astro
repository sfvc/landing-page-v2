---
import "../../styles/global.css";
import { getDatos, getDatosNoticias } from "../../util/obtenerDatos.astro";
import { formatearFecha } from "../../util/formatearFecha.astro";
import NoticiasCard from "../../components/noticiasCard.astro";
import Footer from "../../components/footer.astro";

type Noticia = {
  id: string | number;
  titulo: string;
  fecha: string;
  resumen: string;
  imagen: string;
};

const datosCompletos = await getDatos();
const noticiasCompletas: Noticia[] = await getDatosNoticias();

const { noticia }: { noticia: Noticia } = Astro.props;
const imagenUrl = `https://apis.v1.cc.gob.ar/directus/assets/${noticia.imagen}`;

const relatedNews = noticiasCompletas
  .filter((item: any) => item.id !== noticia.id)
  .slice(0, 3);

export async function getStaticPaths() {
  const noticias = await getDatosNoticias();

  return noticias.map((noticia: any) => ({
    params: { id: noticia.id.toString() },
    props: { noticia },
  }));
}

const fullContent = `
<p class="mb-4">
  Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed euismod, nisl vel ultricies lacinia, nisl nisl aliquam nisl, eget aliquam nisl nisl sit amet nisl. Sed euismod, nisl vel ultricies lacinia, nisl nisl aliquam nisl, eget aliquam nisl nisl sit amet nisl.
</p>
<p class="mb-4">
  Sed euismod, nisl vel ultricies lacinia, nisl nisl aliquam nisl, eget aliquam nisl nisl sit amet nisl. Sed euismod, nisl vel ultricies lacinia, nisl nisl aliquam nisl, eget aliquam nisl nisl sit amet nisl.
</p>
<h3 class="text-2xl font-bold mt-6 mb-4">Subtítulo importante</h3>
<p class="mb-4">
  Sed euismod, nisl vel ultricies lacinia, nisl nisl aliquam nisl, eget aliquam nisl nisl sit amet nisl. Sed euismod, nisl vel ultricies lacinia, nisl nisl aliquam nisl, eget aliquam nisl nisl sit amet nisl.
</p>
<ul class="list-disc pl-6 mb-4">
  <li class="mb-2">Punto importante sobre el evento</li>
  <li class="mb-2">Información relevante para los participantes</li>
  <li class="mb-2">Datos adicionales sobre la actividad</li>
</ul>
<p class="mb-4">
  Sed euismod, nisl vel ultricies lacinia, nisl nisl aliquam nisl, eget aliquam nisl nisl sit amet nisl. Sed euismod, nisl vel ultricies lacinia, nisl nisl aliquam nisl, eget aliquam nisl nisl sit amet nisl.
</p>
<blockquote class="border-l-4 colorPrincipalBorde pl-4 italic my-6">
  "Esta iniciativa representa un gran avance para nuestra comunidad y demuestra el compromiso del municipio con el desarrollo tecnológico local."
</blockquote>
<p class="mb-4">
  Sed euismod, nisl vel ultricies lacinia, nisl nisl aliquam nisl, eget aliquam nisl nisl sit amet nisl. Sed euismod, nisl vel ultricies lacinia, nisl nisl aliquam nisl, eget aliquam nisl nisl sit amet nisl.
</p>
`;
---

<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{noticia.titulo} - {datosCompletos.nombre}</title>
    <link rel="icon" type="image/png" href="/favicon_CATACAPI.png" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"
    />
    <script src="../../scripts/main.js"></script>
  </head>

  <body class="bg-gray-50 text-gray-800 font-sans">
    <header class="bg-white shadow-md sticky top-0 z-50">
      <div
        class="container mx-auto px-4 py-3 flex justify-between items-center"
      >
        <div class="flex items-center space-x-2">
          <a href="/">
            <img src="/logo_CATACAPI_oscuro.png" alt="Logo" class="h-10" />
          </a>
        </div>
        <nav class="hidden md:flex space-x-6">
          <a
            href="/"
            class="colorPrincipalTextoHover font-medium transition-all duration-300 hover:scale-105"
            >Inicio
          </a>
          <a
            href="/#sobre-nosotros"
            class="colorPrincipalTextoHover font-medium transition-all duration-300 hover:scale-105"
            >Sobre Nosotros
          </a>
          <a
            href="/#redes-sociales"
            class="colorPrincipalTextoHover font-medium transition-all duration-300 hover:scale-105"
            >Redes Sociales
          </a>
          <a
            href="/#novedades"
            class="colorPrincipalTextoHover font-medium transition-all duration-300 hover:scale-105"
            >Novedades
          </a>
          <a
            href="/noticias"
            class="colorPrincipalTexto font-medium transition-all duration-300 hover:scale-105"
            >Noticias
          </a>
          <a
            href="/#contacto"
            class="colorPrincipalTextoHover font-medium transition-all duration-300 hover:scale-105"
            >Contacto
          </a>
        </nav>
        <button class="md:hidden colorPrincipalTexto" id="menu-toggle">
          <i class="fas fa-bars text-2xl"></i>
        </button>
      </div>

      <div id="mobile-menu" class="hidden md:hidden bg-white w-full">
        <div class="container mx-auto px-4 py-3 flex flex-col space-y-3">
          <a href="/" class="colorPrincipalTextoHover font-medium"> Inicio </a>
          <a
            href="/#sobre-nosotros"
            class="colorPrincipalTextoHover font-medium"
          >
            Sobre Nosotros
          </a>
          <a
            href="/#redes-sociales"
            class="colorPrincipalTextoHover font-medium"
          >
            Redes Sociales
          </a>
          <a href="/#novedades" class="colorPrincipalTextoHover font-medium">
            Novedades
          </a>
          <a href="/noticias" class="colorPrincipalTexto font-medium">
            Noticias
          </a>
          <a href="/#contacto" class="colorPrincipalTextoHover font-medium">
            Contacto
          </a>
        </div>
      </div>
    </header>

    <div class="bg-gray-100 py-3 border-b">
      <div class="container mx-auto px-4">
        <div class="flex items-center text-sm text-gray-600">
          <a href="/" class="colorPrincipalTextoHover">Inicio</a>
          <span class="mx-2">/</span>
          <a href="/noticias" class="colorPrincipalTextoHover">Noticias</a>
          <span class="mx-2">/</span>
          <span class="text-gray-800">{noticia.titulo}</span>
        </div>
      </div>
    </div>

    <article>
      <div class="container mx-auto px-4 py-12">
        <div class="max-w-4xl mx-auto animate__animated animate__fadeIn">
          <span
            class="inline-block bg-blue-100 colorPrincipalTexto text-sm font-medium px-3 py-1 rounded-full mb-4"
          >
            Noticia
          </span>

          <h1 class="text-3xl md:text-4xl font-bold mb-4">
            {noticia.titulo}
          </h1>

          <div class="flex items-center text-gray-500 mb-6">
            <span class="flex items-center">
              <i class="far fa-calendar mr-2"></i>
              {formatearFecha(noticia.fecha)}
            </span>
            <span class="mx-3">•</span>
            <span class="flex items-center">
              <i class="far fa-clock mr-2"></i>
              5 min de lectura
            </span>
          </div>

          <div
            class="mb-8 animate__animated animate__fadeIn"
            style="animation-delay: 0.2s"
          >
            <img
              src={imagenUrl}
              alt={noticia.titulo}
              class="w-full aspect-video object-cover rounded-lg shadow-md"
            />
          </div>

          <div
            class="mb-8 animate__animated animate__fadeIn"
            style="animation-delay: 0.3s"
          >
            <p
              class="text-xl font-medium text-gray-700 border-l-4 colorPrincipalBorde pl-4 py-2"
            >
              {noticia.resumen}
            </p>
          </div>

          <div
            class="prose prose-lg max-w-none animate__animated animate__fadeIn"
            style="animation-delay: 0.4s"
          >
            <Fragment set:html={fullContent} />
          </div>

          <div class="mt-12 pt-6 border-t border-gray-200">
            <div class="flex items-center justify-between">
              <div></div>
              <a
                href="/noticias"
                class="inline-flex items-center colorPrincipalTexto colorPrincipalTextoHover"
              >
                <i class="fas fa-arrow-left mr-2"></i>
                Volver a noticias
              </a>
            </div>
          </div>
        </div>
      </div>

      <section class="py-12 bg-gray-50">
        <div class="container mx-auto px-4">
          <h2 class="text-3xl font-bold text-center mb-12 colorPrincipalTexto">
            Noticias relacionadas
          </h2>
          <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
            {
              relatedNews.map((item: any, index: any) => (
                <div
                  class="animate__animated animate__fadeIn"
                  style={`animation-delay: ${index * 0.1}s`}
                >
                  <NoticiasCard noticias={item} />
                </div>
              ))
            }
          </div>
        </div>
      </section>

      <Footer />
    </article>
  </body>
</html>
